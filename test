import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns


# Set the style of the plot
sns.set(style="white", context="talk")

# Create subplots
fig, axs = plt.subplots(2, 4, figsize=(20, 10), sharex='col', sharey='row')

# Iterate through the unique clients and plot their data
for i, (client, group) in enumerate(df.groupby('client')):
    ax = axs[i//4, i%4]
    # Calculate max_y_value for the current group
    max_y_value = group['%Spend'].max()
    sns.lineplot(x='Country', y='%Spend', data=group, ax=ax, marker='o')
    # Set y-axis to start at 0% and end at the max value of '%Spend' for the group
    ax.set_ylim(0, max_y_value * 1.1)  # Adding 10% for better visibility of the line at the top
    # Set title for each subplot
    ax.set_title(client)
    # Format y-axis as percentage
    ax.yaxis.set_major_formatter(plt.FuncFormatter(lambda y, _: '{:.0%}'.format(y / 100)))
    # Rotate x-axis labels for better readability
    ax.set_xticklabels(group['Country'], rotation=45)
    # Remove grid lines
    ax.grid(False)
    # Ensure country is treated as a categorical variable
    ax.set_xlabel('Country')
    ax.set_ylabel('% Spend')

# Adjust the layout to prevent overlapping
plt.tight_layout()

# Save the figure
output_file = "clients_spend_by_country_custom_max.png"
plt.savefig(output_file)
